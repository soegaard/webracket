;;;
;;; Helpers
;;;

; (define (cadr x) (car (cdr x)))

(define (->f x)
  (if (exact? x) (exact->inexact x) x))

(define (->i x)
  (if (inexact? x) (inexact->exact x) x))

;;;
;;; TILES
;;; 

(define tile-size    128)
(define tile-margin   32)
(define tile-columns   4)

(define px (/ tile-size 16))

;;;
;;; PALETTE
;;;

(define col-night "#181823")
(define col-deep-shadow "#0c0d16")
(define col-outline "#111423")
(define col-fur-light "#f5e6c6")
(define col-fur-main "#d5b591")
(define col-fur-dark "#b98d62")
(define col-mask-dark "#3d3f56")
(define col-mask-light "#6a6d86")
(define col-eye "#0f1220")
(define col-eye-shine "#f8f1dc")
(define col-flag-main "#f7c744")
(define col-flag-light "#ffe27a")
(define col-flag-shadow "#b98524")
(define col-grass-dark "#2f4d1d")
(define col-grass-main "#3e6f2b")
(define col-grass-light "#62a434")
(define col-mud-main "#4a3523")
(define col-mud-light "#6b4a2d")
(define col-mud-dark "#2e2116")
(define col-water-dark "#1e364f")
(define col-water-main "#265779")
(define col-water-light "#4b8bc4")
(define col-bridge-dark "#5b3b20")
(define col-bridge-main "#80522c")
(define col-bridge-light "#a0652f")
(define col-stone-dark "#2e303f")
(define col-stone-main "#4f5265")
(define col-stone-light "#7a7d90")
(define col-stone-edge "#9da1ba")
(define col-log-main "#6a3a1d")
(define col-log-light "#8b4c26")
(define col-metal-dark "#302620")
(define col-metal-main "#4a3526")
(define col-metal-highlight "#6b4a32")
(define col-key-main "#f7c744")
(define col-key-light "#ffe27a")
(define col-key-dark "#b98524")
(define col-door-wood "#7d4b28")
(define col-door-shadow "#512f1a")
(define col-door-frame "#c68d44")
(define col-door-highlight "#f5e6c6")
(define col-bomb-body "#1e2233")
(define col-bomb-light "#333a52")
(define col-bomb-fuse "#f3d47c")
(define col-bomb-spark "#ff9c3a")

;;;
;;; TILES
;;;

(define tiles-per-row tile-columns)
(define tiles
  '(draw-hero-raccoon
    draw-yellow-flag
    draw-mud
    draw-grass
    draw-water
    draw-bridge
    draw-stone-wall
    draw-tree-log
    draw-golden-key
    draw-lock
    draw-closed-door
    draw-open-door
    draw-bomb))


(define tile-count (length tiles))
(define tile-rows  (ceiling (/ tile-count tiles-per-row)))


;;;
;;; CANVAS
;;;

(define canvas-width  (->i (+ (* tiles-per-row tile-size) (* (+ tiles-per-row 1) tile-margin))))
(define canvas-height (->i (+ (* tile-rows     tile-size) (* (+ tile-rows     1) tile-margin))))


;;;
;;; DOM
;;;

(define canvas (js-create-element "canvas"))
(js-set-canvas-width!  canvas canvas-width)
(js-set-canvas-height! canvas canvas-height)
(js-set-attribute! canvas "style"
                   (string-append
                    "background: #202124; image-rendering: pixelated; "
                    "display: block; margin: 32px auto; border: 2px solid #333; "
                    "box-shadow: 0 12px 36px rgba(0, 0, 0, 0.35);"))
(js-set-attribute! (js-document-body) "style"
                   "margin: 0; background: #111; font-family: 'Fira Code', monospace; color: #fafafa;")
(js-append-child! (js-document-body) canvas)

(define ctx (js-canvas-get-context canvas "2d" (js-undefined)))

;;;
;;; Graphics
;;;

(define (fill color x y w h)
  (js-set-canvas2d-fill-style! ctx color)
  (js-canvas2d-fill-rect ctx (->f x) (->f y) (->f w) (->f h)))

(define (tile-patch x y color dx dy w h)
  (fill color (+ x (* dx px)) (+ y (* dy px)) (* w px) (* h px)))

(define (draw-hero-raccoon x y)
  (define cell (/ tile-size 24))
  (define (patch color dx dy [w 1] [h 1])
    (fill color (+ x (* dx cell)) (+ y (* dy cell)) (* w cell) (* h cell)))
  (define background "#141418")
  (fill background x y tile-size tile-size)
  ;; Sprite traced from the provided 24Ã—24 hero tile reference.
  (patch "#141318" 5 0 1 1)
  (patch "#000002" 9 0 1 1)
  (patch "#010005" 10 0 1 1)
  (patch "#000000" 11 0 1 1)
  (patch "#151418" 12 0 1 1)
  (patch "#141318" 15 0 1 1)
  (patch "#151518" 16 0 1 1)
  (patch "#000002" 17 0 1 1)
  (patch "#010004" 18 0 1 1)
  (patch "#020004" 19 0 1 1)
  (patch "#000003" 20 0 1 1)
  (patch "#151418" 21 0 1 1)
  (patch "#141317" 7 1 1 1)
  (patch "#000000" 8 1 4 1)
  (patch "#010004" 12 1 1 1)
  (patch "#000003" 13 1 1 1)
  (patch "#151418" 14 1 1 1)
  (patch "#141417" 15 1 1 1)
  (patch "#010004" 16 1 1 1)
  (patch "#000000" 17 1 4 1)
  (patch "#151418" 21 1 3 1)
  (patch "#141318" 2 2 1 1)
  (patch "#141318" 6 2 1 1)
  (patch "#000003" 8 2 1 1)
  (patch "#000000" 9 2 1 1)
  (patch "#b9874c" 10 2 1 1)
  (patch "#bb874d" 11 2 1 1)
  (patch "#000000" 12 2 2 1)
  (patch "#000001" 14 2 1 1)
  (patch "#000002" 15 2 1 1)
  (patch "#010104" 16 2 1 1)
  (patch "#000000" 17 2 1 1)
  (patch "#bb884c" 18 2 1 1)
  (patch "#bc884d" 19 2 1 1)
  (patch "#000000" 20 2 2 1)
  (patch "#151418" 22 2 1 1)
  (patch "#141318" 23 2 1 1)
  (patch "#141317" 6 3 1 1)
  (patch "#010004" 8 3 1 1)
  (patch "#000000" 9 3 1 1)
  (patch "#ba874c" 10 3 1 1)
  (patch "#ba884c" 11 3 1 1)
  (patch "#ba884e" 12 3 1 1)
  (patch "#000000" 13 3 1 1)
  (patch "#000003" 14 3 1 1)
  (patch "#000004" 15 3 1 1)
  (patch "#000000" 16 3 2 1)
  (patch "#bb884d" 18 3 2 1)
  (patch "#000000" 20 3 1 1)
  (patch "#000003" 21 3 1 1)
  (patch "#151418" 23 3 1 1)
  (patch "#141318" 3 4 2 1)
  (patch "#151418" 6 4 2 1)
  (patch "#010003" 8 4 1 1)
  (patch "#000000" 9 4 1 1)
  (patch "#ba884c" 10 4 1 1)
  (patch "#bb894d" 11 4 2 1)
  (patch "#ba874c" 13 4 1 1)
  (patch "#b9884c" 14 4 1 1)
  (patch "#bb894d" 15 4 1 1)
  (patch "#ba874c" 16 4 1 1)
  (patch "#bb884d" 17 4 1 1)
  (patch "#ba884d" 18 4 1 1)
  (patch "#b9894c" 19 4 1 1)
  (patch "#000000" 20 4 1 1)
  (patch "#010004" 21 4 1 1)
  (patch "#151418" 22 4 1 1)
  (patch "#000000" 6 5 1 1)
  (patch "#000002" 7 5 1 1)
  (patch "#000000" 8 5 1 1)
  (patch "#bb894c" 9 5 1 1)
  (patch "#bb894d" 10 5 1 1)
  (patch "#bb894e" 11 5 1 1)
  (patch "#bb884d" 12 5 2 1)
  (patch "#ba884e" 14 5 1 1)
  (patch "#bb894c" 15 5 1 1)
  (patch "#ba894c" 16 5 1 1)
  (patch "#bb884e" 17 5 1 1)
  (patch "#ba884c" 18 5 1 1)
  (patch "#ba894d" 19 5 1 1)
  (patch "#000000" 20 5 2 1)
  (patch "#010104" 22 5 1 1)
  (patch "#141318" 1 6 1 1)
  (patch "#151418" 5 6 2 1)
  (patch "#010004" 7 6 1 1)
  (patch "#bb884e" 8 6 1 1)
  (patch "#ba894d" 9 6 1 1)
  (patch "#bb894e" 10 6 1 1)
  (patch "#bc894e" 11 6 1 1)
  (patch "#bb894e" 12 6 1 1)
  (patch "#bb8a4e" 13 6 1 1)
  (patch "#2b1f24" 14 6 1 1)
  (patch "#bb884e" 15 6 1 1)
  (patch "#ba884d" 16 6 1 1)
  (patch "#bb894e" 17 6 1 1)
  (patch "#ba884e" 18 6 1 1)
  (patch "#ba894d" 19 6 1 1)
  (patch "#ba844b" 20 6 1 1)
  (patch "#000003" 21 6 1 1)
  (patch "#010004" 22 6 1 1)
  (patch "#151418" 23 6 1 1)
  (patch "#151418" 2 7 1 1)
  (patch "#151418" 5 7 1 1)
  (patch "#010002" 6 7 1 1)
  (patch "#010004" 7 7 1 1)
  (patch "#bb884d" 8 7 1 1)
  (patch "#bb894d" 9 7 1 1)
  (patch "#ba874d" 10 7 1 1)
  (patch "#ba894e" 11 7 1 1)
  (patch "#2b2027" 12 7 1 1)
  (patch "#2b2026" 13 7 1 1)
  (patch "#2c2126" 14 7 1 1)
  (patch "#2c2127" 15 7 1 1)
  (patch "#2b1f26" 16 7 1 1)
  (patch "#2c2227" 17 7 1 1)
  (patch "#2b1f25" 18 7 1 1)
  (patch "#2c2027" 19 7 2 1)
  (patch "#000000" 21 7 1 1)
  (patch "#010004" 22 7 1 1)
  (patch "#151418" 23 7 1 1)
  (patch "#151418" 0 8 1 1)
  (patch "#141318" 2 8 1 1)
  (patch "#151418" 4 8 1 1)
  (patch "#151419" 6 8 1 1)
  (patch "#010004" 7 8 1 1)
  (patch "#bc884d" 8 8 1 1)
  (patch "#ba884d" 9 8 1 1)
  (patch "#ba864e" 10 8 1 1)
  (patch "#270f0a" 11 8 1 1)
  (patch "#2b1f25" 12 8 1 1)
  (patch "#2b2025" 13 8 1 1)
  (patch "#2a1f25" 14 8 1 1)
  (patch "#000002" 15 8 1 1)
  (patch "#000000" 16 8 1 1)
  (patch "#2b2025" 17 8 1 1)
  (patch "#2b1f26" 18 8 1 1)
  (patch "#2a1f25" 19 8 1 1)
  (patch "#000002" 20 8 1 1)
  (patch "#010004" 21 8 1 1)
  (patch "#010005" 22 8 1 1)
  (patch "#151418" 23 8 1 1)
  (patch "#151418" 1 9 1 1)
  (patch "#151417" 2 9 1 1)
  (patch "#151418" 4 9 2 1)
  (patch "#161519" 6 9 1 1)
  (patch "#010004" 7 9 1 1)
  (patch "#b8874c" 8 9 1 1)
  (patch "#ba884d" 9 9 1 1)
  (patch "#ba874d" 10 9 1 1)
  (patch "#2a1f25" 11 9 1 1)
  (patch "#2b2025" 12 9 1 1)
  (patch "#2a1f24" 13 9 1 1)
  (patch "#2b1f25" 14 9 1 1)
  (patch "#020005" 15 9 1 1)
  (patch "#000000" 16 9 1 1)
  (patch "#2a1f25" 17 9 2 1)
  (patch "#2b1f25" 19 9 1 1)
  (patch "#000000" 20 9 1 1)
  (patch "#010004" 21 9 2 1)
  (patch "#000000" 23 9 1 1)
  (patch "#151418" 0 10 1 1)
  (patch "#151519" 1 10 1 1)
  (patch "#020005" 2 10 1 1)
  (patch "#000000" 3 10 1 1)
  (patch "#000001" 4 10 1 1)
  (patch "#161418" 5 10 1 1)
  (patch "#141318" 6 10 1 1)
  (patch "#010004" 7 10 1 1)
  (patch "#010001" 8 10 1 1)
  (patch "#ba8a4b" 9 10 1 1)
  (patch "#bb884f" 10 10 1 1)
  (patch "#2b1f26" 11 10 1 1)
  (patch "#291e26" 12 10 1 1)
  (patch "#2a1f24" 13 10 1 1)
  (patch "#291e24" 14 10 1 1)
  (patch "#000000" 15 10 2 1)
  (patch "#291e22" 17 10 1 1)
  (patch "#2a2026" 18 10 1 1)
  (patch "#000000" 19 10 1 1)
  (patch "#000003" 20 10 1 1)
  (patch "#000005" 21 10 1 1)
  (patch "#000000" 22 10 1 1)
  (patch "#010005" 23 10 1 1)
  (patch "#16151a" 0 11 1 1)
  (patch "#000000" 1 11 2 1)
  (patch "#020004" 3 11 1 1)
  (patch "#020005" 4 11 1 1)
  (patch "#17161b" 5 11 1 1)
  (patch "#151417" 6 11 1 1)
  (patch "#161519" 7 11 1 1)
  (patch "#000003" 8 11 1 1)
  (patch "#000000" 9 11 1 1)
  (patch "#ba894e" 10 11 1 1)
  (patch "#bb874b" 11 11 1 1)
  (patch "#261e25" 12 11 1 1)
  (patch "#291e23" 13 11 1 1)
  (patch "#2a1f25" 14 11 1 1)
  (patch "#2a1f23" 15 11 1 1)
  (patch "#ba884d" 16 11 1 1)
  (patch "#b8854b" 17 11 1 1)
  (patch "#b8864f" 18 11 1 1)
  (patch "#000000" 19 11 1 1)
  (patch "#010004" 20 11 1 1)
  (patch "#000000" 21 11 2 1)
  (patch "#010005" 23 11 1 1)
  (patch "#010004" 0 12 1 1)
  (patch "#000000" 1 12 1 1)
  (patch "#291e24" 2 12 1 1)
  (patch "#291e25" 3 12 1 1)
  (patch "#281d24" 4 12 1 1)
  (patch "#000000" 5 12 1 1)
  (patch "#000002" 6 12 1 1)
  (patch "#171619" 7 12 1 1)
  (patch "#15151a" 8 12 1 1)
  (patch "#000000" 9 12 2 1)
  (patch "#ba884c" 11 12 1 1)
  (patch "#bb894c" 12 12 1 1)
  (patch "#bb894d" 13 12 1 1)
  (patch "#bd894e" 14 12 1 1)
  (patch "#bb884e" 15 12 1 1)
  (patch "#bb894e" 16 12 1 1)
  (patch "#bb884d" 17 12 1 1)
  (patch "#bb894d" 18 12 1 1)
  (patch "#bb8a4d" 19 12 1 1)
  (patch "#bc894e" 20 12 1 1)
  (patch "#000000" 21 12 2 1)
  (patch "#141317" 23 12 1 1)
  (patch "#010005" 0 13 1 1)
  (patch "#000000" 1 13 1 1)
  (patch "#291e25" 2 13 1 1)
  (patch "#271e24" 3 13 1 1)
  (patch "#281c24" 4 13 1 1)
  (patch "#000000" 5 13 2 1)
  (patch "#020005" 7 13 1 1)
  (patch "#030107" 8 13 1 1)
  (patch "#000000" 9 13 2 1)
  (patch "#bb894e" 11 13 2 1)
  (patch "#bc894e" 13 13 1 1)
  (patch "#bb894e" 14 13 1 1)
  (patch "#bc8a50" 15 13 1 1)
  (patch "#bc894e" 16 13 1 1)
  (patch "#000002" 17 13 1 1)
  (patch "#000000" 18 13 3 1)
  (patch "#010005" 21 13 1 1)
  (patch "#020004" 22 13 1 1)
  (patch "#020005" 0 14 1 1)
  (patch "#000000" 1 14 1 1)
  (patch "#291e25" 2 14 1 1)
  (patch "#271d24" 3 14 1 1)
  (patch "#a87b46" 4 14 1 1)
  (patch "#a57948" 5 14 1 1)
  (patch "#000000" 6 14 1 1)
  (patch "#010105" 7 14 1 1)
  (patch "#010004" 8 14 1 1)
  (patch "#000000" 9 14 1 1)
  (patch "#bb884d" 10 14 1 1)
  (patch "#bc894e" 11 14 1 1)
  (patch "#bb894d" 12 14 1 1)
  (patch "#bb894e" 13 14 1 1)
  (patch "#bd8a4e" 14 14 1 1)
  (patch "#bc8b4f" 15 14 1 1)
  (patch "#be8a4e" 16 14 1 1)
  (patch "#000000" 17 14 4 1)
  (patch "#010005" 21 14 1 1)
  (patch "#161519" 22 14 1 1)
  (patch "#151418" 23 14 1 1)
  (patch "#010004" 0 15 1 1)
  (patch "#000000" 1 15 1 1)
  (patch "#2b1f23" 2 15 1 1)
  (patch "#b7854e" 3 15 1 1)
  (patch "#b7874f" 4 15 1 1)
  (patch "#2a202a" 5 15 1 1)
  (patch "#291e25" 6 15 1 1)
  (patch "#291d24" 7 15 1 1)
  (patch "#020105" 8 15 1 1)
  (patch "#000000" 9 15 1 1)
  (patch "#bb894d" 10 15 2 1)
  (patch "#bb894c" 12 15 1 1)
  (patch "#b9884d" 13 15 1 1)
  (patch "#bd8b4e" 14 15 1 1)
  (patch "#d0ac82" 15 15 1 1)
  (patch "#d2ad85" 16 15 1 1)
  (patch "#d1ad84" 17 15 1 1)
  (patch "#d0ac83" 18 15 1 1)
  (patch "#d0ad83" 19 15 1 1)
  (patch "#000000" 20 15 1 1)
  (patch "#000004" 21 15 1 1)
  (patch "#161519" 22 15 1 1)
  (patch "#151519" 23 15 1 1)
  (patch "#151519" 0 16 1 1)
  (patch "#000000" 1 16 2 1)
  (patch "#b7874e" 3 16 1 1)
  (patch "#291e26" 4 16 1 1)
  (patch "#291e24" 5 16 1 1)
  (patch "#2a1f25" 6 16 1 1)
  (patch "#291e24" 7 16 1 1)
  (patch "#010005" 8 16 1 1)
  (patch "#000000" 9 16 1 1)
  (patch "#bb894e" 10 16 1 1)
  (patch "#bb884e" 11 16 1 1)
  (patch "#000000" 12 16 2 1)
  (patch "#d0ab83" 14 16 1 1)
  (patch "#d1ad84" 15 16 1 1)
  (patch "#d0ad84" 16 16 1 1)
  (patch "#d1ac83" 17 16 1 1)
  (patch "#d0ac83" 18 16 1 1)
  (patch "#d2ac83" 19 16 1 1)
  (patch "#000100" 20 16 1 1)
  (patch "#010005" 21 16 1 1)
  (patch "#010004" 22 16 1 1)
  (patch "#161519" 0 17 1 1)
  (patch "#020105" 1 17 1 1)
  (patch "#000000" 2 17 2 1)
  (patch "#2a1f25" 4 17 1 1)
  (patch "#291e25" 5 17 1 1)
  (patch "#2a1f24" 6 17 1 1)
  (patch "#2a1f25" 7 17 1 1)
  (patch "#020004" 8 17 1 1)
  (patch "#000000" 9 17 3 1)
  (patch "#000002" 12 17 1 1)
  (patch "#000000" 13 17 1 1)
  (patch "#d1ad84" 14 17 2 1)
  (patch "#d1ac84" 16 17 2 1)
  (patch "#d0ac83" 18 17 1 1)
  (patch "#d2ac83" 19 17 1 1)
  (patch "#010003" 20 17 1 1)
  (patch "#010005" 21 17 1 1)
  (patch "#020105" 22 17 1 1)
  (patch "#151418" 23 17 1 1)
  (patch "#161519" 1 18 1 1)
  (patch "#000001" 2 18 2 1)
  (patch "#2a1f25" 4 18 1 1)
  (patch "#291e23" 5 18 1 1)
  (patch "#000000" 6 18 1 1)
  (patch "#a47747" 7 18 1 1)
  (patch "#010004" 8 18 1 1)
  (patch "#000004" 9 18 1 1)
  (patch "#000000" 10 18 4 1)
  (patch "#d1ac83" 14 18 1 1)
  (patch "#d0ab82" 15 18 1 1)
  (patch "#d1ac83" 16 18 1 1)
  (patch "#d0ac82" 17 18 1 1)
  (patch "#d0ab82" 18 18 1 1)
  (patch "#d0ac82" 19 18 1 1)
  (patch "#020004" 20 18 1 1)
  (patch "#010004" 21 18 1 1)
  (patch "#020105" 22 18 1 1)
  (patch "#151418" 23 18 1 1)
  (patch "#151418" 0 19 1 1)
  (patch "#151418" 2 19 1 1)
  (patch "#000002" 3 19 2 1)
  (patch "#010004" 5 19 1 1)
  (patch "#000000" 6 19 1 1)
  (patch "#9f7545" 7 19 1 1)
  (patch "#000000" 8 19 2 1)
  (patch "#bc884e" 10 19 1 1)
  (patch "#bd8b4e" 11 19 1 1)
  (patch "#d1aa7f" 12 19 1 1)
  (patch "#d0ac83" 13 19 1 1)
  (patch "#d1ac83" 14 19 1 1)
  (patch "#d1ac82" 15 19 1 1)
  (patch "#d1ac83" 16 19 2 1)
  (patch "#000000" 18 19 1 1)
  (patch "#020005" 19 19 1 1)
  (patch "#020004" 20 19 1 1)
  (patch "#010004" 21 19 1 1)
  (patch "#151519" 22 19 1 1)
  (patch "#151419" 23 19 1 1)
  (patch "#151418" 0 20 3 1)
  (patch "#151419" 3 20 1 1)
  (patch "#151519" 4 20 2 1)
  (patch "#000002" 6 20 1 1)
  (patch "#010004" 7 20 1 1)
  (patch "#010105" 8 20 1 1)
  (patch "#000002" 9 20 1 1)
  (patch "#bc894d" 10 20 1 1)
  (patch "#be8b52" 11 20 1 1)
  (patch "#000000" 12 20 1 1)
  (patch "#010004" 13 20 1 1)
  (patch "#000005" 14 20 1 1)
  (patch "#010004" 15 20 1 1)
  (patch "#000000" 16 20 3 1)
  (patch "#010004" 19 20 1 1)
  (patch "#000000" 20 20 1 1)
  (patch "#151418" 21 20 1 1)
  (patch "#151418" 23 20 1 1)
  (patch "#151418" 0 21 1 1)
  (patch "#151418" 2 21 1 1)
  (patch "#141417" 3 21 1 1)
  (patch "#151418" 4 21 2 1)
  (patch "#151419" 6 21 1 1)
  (patch "#010004" 7 21 1 1)
  (patch "#010006" 8 21 1 1)
  (patch "#000004" 9 21 1 1)
  (patch "#000000" 10 21 2 1)
  (patch "#020005" 12 21 1 1)
  (patch "#010004" 13 21 1 1)
  (patch "#000001" 14 21 1 1)
  (patch "#000000" 15 21 2 1)
  (patch "#18161a" 17 21 1 1)
  (patch "#010005" 18 21 2 1)
  (patch "#020105" 20 21 1 1)
  (patch "#161519" 21 21 1 1)
  (patch "#151419" 22 21 2 1)
  (patch "#151418" 2 22 1 1)
  (patch "#151418" 5 22 3 1)
  (patch "#010005" 8 22 1 1)
  (patch "#000002" 9 22 1 1)
  (patch "#000003" 10 22 1 1)
  (patch "#020106" 11 22 2 1)
  (patch "#000004" 13 22 1 1)
  (patch "#151518" 14 22 1 1)
  (patch "#151519" 15 22 2 1)
  (patch "#000001" 17 22 1 1)
  (patch "#020005" 18 22 1 1)
  (patch "#020105" 19 22 2 1)
  (patch "#151419" 21 22 1 1)
  (patch "#151418" 22 22 1 1)
  (patch "#141419" 23 22 1 1)
  (patch "#151418" 0 23 1 1)
  (patch "#151418" 5 23 3 1)
  (patch "#151419" 8 23 1 1)
  (patch "#151418" 9 23 2 1)
  (patch "#151518" 11 23 2 1)
  (patch "#151418" 13 23 5 1)
  (patch "#151419" 18 23 2 1)
  (patch "#141419" 20 23 1 1)
  (patch "#151418" 22 23 1 1))

#;(define (draw-hero-raccoon x y)
  (define (patch color dx dy [w 1] [h 1])
    (tile-patch x y color dx dy w h))

  (fill col-night x y tile-size tile-size)
  ;; Pixel layout sampled from the provided raccoon sprite
  (patch col-outline 6 1 2 1)
  (patch col-outline 11 1 1 1)
  (patch col-fur-main 6 2 2 1)
  (patch col-outline 8 2 1 1)
  (patch col-outline 10 2 1 1)
  (patch col-fur-main 11 2 1 1)
  (patch col-mask-dark 12 2 1 1)
  (patch col-fur-main 6 3 2 1)
  (patch col-outline 8 3 1 1)
  (patch col-mask-dark 9 3 1 1)
  (patch col-outline 10 3 1 1)
  (patch col-fur-main 11 3 1 1)
  (patch col-mask-dark 12 3 1 1)
  (patch col-outline 5 4 1 1)
  (patch col-fur-main 6 4 7 1)
  (patch col-mask-dark 13 4 1 1)
  (patch col-outline 5 5 1 1)
  (patch col-fur-main 6 5 2 1)
  (patch col-fur-dark 8 5 5 1)
  (patch col-mask-dark 13 5 1 1)
  (patch col-eye-shine 4 6 1 1)
  (patch col-fur-light 5 6 1 1)
  (patch col-fur-main 6 6 1 1)
  (patch col-fur-dark 7 6 2 1)
  (patch col-mask-dark 9 6 1 1)
  (patch col-fur-dark 10 6 1 1)
  (patch col-eye-shine 11 6 1 1)
  (patch col-mask-dark 12 6 2 1)
  (patch col-outline 2 7 2 1)
  (patch col-eye 5 7 1 1)
  (patch col-fur-main 6 7 2 1)
  (patch col-fur-dark 8 7 1 1)
  (patch col-fur-dark 10 7 2 1)
  (patch col-eye 12 7 1 1)
  (patch col-fur-dark 13 7 1 1)
  (patch col-outline 1 8 1 1)
  (patch col-fur-dark 2 8 2 1)
  (patch col-mask-dark 4 8 1 1)
  (patch col-mask-dark 6 8 1 1)
  (patch col-fur-main 7 8 6 1)
  (patch col-mask-dark 13 8 1 1)
  (patch col-outline 1 9 1 1)
  (patch col-fur-dark 2 9 1 1)
  (patch col-fur-main 3 9 2 1)
  (patch col-mask-dark 5 9 1 1)
  (patch col-fur-main 6 9 5 1)
  (patch col-mask-dark 11 9 2 1)
  (patch col-outline 1 10 1 1)
  (patch col-fur-light 2 10 1 1)
  (patch col-fur-main 3 10 1 1)
  (patch col-fur-dark 4 10 1 1)
  (patch col-mask-dark 5 10 1 1)
  (patch col-fur-main 6 10 3 1)
  (patch col-fur-light 9 10 3 1)
  (patch col-mask-dark 12 10 1 1)
  (patch col-fur-light 2 11 1 1)
  (patch col-fur-dark 3 11 2 1)
  (patch col-mask-dark 5 11 1 1)
  (patch col-fur-main 6 11 3 1)
  (patch col-fur-light 9 11 3 1)
  (patch col-mask-dark 12 11 2 1)
  (patch col-outline 3 12 2 1)
  (patch col-mask-dark 5 12 1 1)
  (patch col-fur-main 6 12 2 1)
  (patch col-fur-light 8 12 3 1)
  (patch col-mask-dark 11 12 2 1)
  (patch col-outline 5 13 1 1)
  (patch col-fur-main 6 13 2 1)
  (patch col-mask-dark 8 13 4 1)
  (patch col-outline 5 14 4 1)
  (patch col-outline 11 14 2 1))
  

(define (draw-yellow-flag x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-water-dark x y tile-size tile-size)
  (patch col-night 0 12 16 4)
  (patch col-grass-dark 0 11 16 1)
  (patch col-grass-main 0 10 16 1)
  (patch "#8f949f" 7 2 2 12)
  (patch "#cfd6e4" 7 2 1 12)
  (patch col-flag-shadow 8 4 5 4)
  (patch col-flag-main 8 3 6 6)
  (patch col-flag-light 9 3 4 2)
  (patch col-flag-light 9 5 3 1)
  (patch col-flag-shadow 8 7 6 1))

(define (draw-mud x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-mud-dark x y tile-size tile-size)
  (patch col-mud-main 0 2 16 12)
  (patch col-mud-light 0 2 16 2)
  (patch col-mud-dark 1 8 3 2)
  (patch col-mud-dark 6 5 4 2)
  (patch col-mud-dark 11 9 3 2)
  (patch col-mud-light 3 12 4 1)
  (patch col-mud-light 9 10 3 1)
  (patch col-mud-light 12 6 2 1))

(define (draw-grass x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-grass-dark x y tile-size tile-size)
  (patch col-grass-main 0 2 16 12)
  (patch col-grass-light 0 2 16 2)
  (patch col-grass-light 2 5 2 4)
  (patch col-grass-light 5 4 2 5)
  (patch col-grass-light 8 5 2 4)
  (patch col-grass-light 11 4 2 5)
  (patch col-grass-light 13 5 1 4)
  (patch col-grass-dark 0 12 16 2)
  (patch col-night 0 12 16 4))

(define (draw-water x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-water-dark x y tile-size tile-size)
  (patch col-water-main 0 2 16 12)
  (patch col-water-light 0 3 16 1)
  (patch col-water-light 2 7 12 1)
  (patch col-water-light 1 11 14 1)
  (patch col-water-main 0 12 16 1)
  (patch col-night 0 12 16 4)
  (patch col-water-light 12 5 2 1)
  (patch col-water-light 3 9 3 1))

(define (draw-bridge x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-water-dark x y tile-size tile-size)
  (patch col-water-main 0 2 16 12)
  (patch col-water-light 0 3 16 1)
  (patch col-water-light 2 9 3 1)
  (patch col-water-light 12 7 2 1)
  (patch col-bridge-dark 0 7 16 2)
  (patch col-bridge-main 0 6 16 4)
  (patch col-bridge-light 0 6 16 1)
  (patch col-bridge-light 0 9 16 1)
  (patch col-outline 0 6 16 1/2)
  (patch col-outline 0 9 16 1/2)
  (patch col-bridge-dark 2 6 1 4)
  (patch col-bridge-dark 6 6 1 4)
  (patch col-bridge-dark 10 6 1 4)
  (patch col-bridge-dark 14 6 1 4)
  (patch col-night 0 12 16 4))


(define (draw-stone-wall x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-stone-dark x y tile-size tile-size)
  (patch col-stone-main 0 2 16 12)
  (patch col-stone-edge 0 2 16 1)
  (patch col-stone-light 0 7 16 1)
  (patch col-stone-light 0 11 16 1)
  (patch col-outline 0 6 16 1/2)
  (patch col-outline 0 10 16 1/2)
  (patch col-stone-light 1 3 5 3)
  (patch col-stone-main 6 3 5 3)
  (patch col-stone-light 11 3 4 3)
  (patch col-stone-main 1 8 4 3)
  (patch col-stone-light 5 8 5 3)
  (patch col-stone-main 10 8 5 3)
  (patch col-night 0 12 16 4))

(define (draw-tree-log x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-grass-dark x y tile-size tile-size)
  (patch col-grass-main 0 2 16 12)
  (patch col-grass-light 0 2 16 1)
  (patch col-log-main 1 6 14 5)
  (patch col-log-light 1 6 14 1)
  (patch col-log-light 1 9 14 1)
  (patch col-outline 1 6 14 1/2)
  (patch col-outline 1 21/2 14 1/2)
  (patch col-log-light 3 7 2 3)
  (patch col-log-light 7 7 2 3)
  (patch col-log-light 11 7 2 3)
  (patch col-night 0 12 16 4))

(define (draw-golden-key x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-night x y tile-size tile-size)
  (patch col-deep-shadow 0 12 16 4)
  (patch col-key-main 3 5 6 6)
  (patch col-key-dark 3 7 6 2)
  (patch col-key-light 4 6 4 2)
  (patch col-night 4 6 2 2)
  (patch col-night 5 7 1 1)
  (patch col-key-main 8 7 6 2)
  (patch col-key-main 11 6 2 4)
  (patch col-key-light 11 6 2 1)
  (patch col-key-light 8 7 4 1)
  (patch col-key-dark 11 8 2 1)
  (patch col-key-main 11 9 2 2)
  (patch col-key-dark 11 9 2 1/2)
  (patch col-key-main 9 8 2 1)
  (patch col-key-main 9 9 1 1)
  (patch col-key-main 7 9 2 1)
  (patch col-key-dark 7 9 1 1/2))

(define (draw-lock x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-night x y tile-size tile-size)
  (patch col-deep-shadow 0 12 16 4)
  (patch col-metal-dark 5 3 6 4)
  (patch col-metal-main 5 3 6 4)
  (patch col-night 5 3 1 1)
  (patch col-night 10 3 1 1)
  (patch col-metal-highlight 6 4 4 1)
  (patch col-metal-main 4 6 8 7)
  (patch col-metal-dark 4 6 8 1)
  (patch col-metal-highlight 5 7 6 1)
  (patch col-metal-dark 4 12 8 1)
  (patch col-metal-highlight 5 12 6 1/2)
  (patch col-key-light 7 8 2 3)
  (patch col-key-dark 7 9 2 1)
  (patch col-outline 6 6 1 7)
  (patch col-outline 10 6 1 7)
  (patch col-outline 6 9 4 1))

(define (draw-closed-door x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-stone-dark x y tile-size tile-size)
  (patch col-stone-main 0 2 16 12)
  (patch col-door-frame 2 3 12 11)
  (patch col-door-wood 4 4 8 9)
  (patch col-door-shadow 4 8 8 1)
  (patch col-door-shadow 4 11 8 1)
  (patch col-door-highlight 10 9 1 1)
  (patch col-outline 2 3 12 1)
  (patch col-outline 2 14 12 1)
  (patch col-outline 2 3 1 11)
  (patch col-outline 13 3 1 11)
  (patch col-night 0 12 16 4))

(define (draw-open-door x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-stone-dark x y tile-size tile-size)
  (patch col-stone-main 0 2 16 12)
  (patch col-door-frame 2 3 12 11)
  (patch col-night 4 4 8 9)
  (patch col-door-shadow 3 4 1 9)
  (patch col-door-shadow 4 4 1 9)
  (patch col-door-highlight 11 9 1 1)
  (patch col-outline 2 3 12 1)
  (patch col-outline 2 14 12 1)
  (patch col-outline 2 3 1 11)
  (patch col-outline 13 3 1 11)
  (patch col-night 0 12 16 4))

(define (draw-bomb x y)
  (define (patch color dx dy w h)
    (tile-patch x y color dx dy w h))
  (fill col-night x y tile-size tile-size)
  (patch col-deep-shadow 0 12 16 4)
  (patch col-bomb-body 4 5 8 7)
  (patch col-bomb-light 5 6 6 2)
  (patch col-bomb-light 6 8 4 2)
  (patch col-outline 4 5 8 1)
  (patch col-outline 4 11 8 1)
  (patch col-outline 4 5 1 7)
  (patch col-outline 11 5 1 7)
  (patch col-bomb-light 7 4 2 1)
  (patch col-bomb-body 7 3 2 1)
  (patch col-bomb-fuse 7 2 2 1)
  (patch col-bomb-spark 8 1 1 1)
  (patch col-bomb-spark 7 0 1 1/2)
  (patch col-bomb-spark 9 1 1 1/2))



;;;
;;; DRAW
;;;


(fill "#181818" 0 0 canvas-width canvas-height)

(define tile-drawers
  (list draw-hero-raccoon
        draw-yellow-flag
        draw-mud
        draw-grass
        draw-water
        draw-bridge
        draw-stone-wall
        draw-tree-log
        draw-golden-key
        draw-lock
        draw-closed-door
        draw-open-door
        draw-bomb))

#;((car tile-drawers) 0. 0.)


(let loop ([ts tile-drawers] [index 0])
  (when (pair? ts)
    (define row    (quotient  index tiles-per-row))
    (define col    (remainder index tiles-per-row))
    (define tile-x (+ tile-margin (* col (+ tile-size tile-margin))))
    (define tile-y (+ tile-margin (* row (+ tile-size tile-margin))))
    ((car ts) tile-x tile-y)
    (loop (cdr ts) (add1 index))))


#;(draw-hero-raccoon 0 0)
